#!/usr/bin/env ruby

require File.expand_path(File.join(File.dirname(__FILE__), '..', 'lib', 'minglr'))

rc_config = MinglrConfigParser.parse
uri_options = rc_config[:global] || {}
project = rc_config[:global][:default].to_sym if rc_config[:global][:default]
original_arguments = ARGV

if MinglrAction::ACTIONS.include?(ARGV[0])
  action = ARGV[0]
else
  if ARGV[0] && (ARGV[0] =~ /^--/).nil?
    project = ARGV[0].to_sym 
    action = ARGV[1]
  end
end

unless project.nil?
  uri_options.merge! rc_config[project]
  Resources::Base.configure uri_options
  Resources::Attachment.configure
  extra_options = MinglrOptionsParser.parse(original_arguments)
  MinglrAction.execute(action, ARGV, extra_options, rc_config[project])
end